# Architecture Decision Records (ADR)

このファイルは、プロジェクトの重要な技術的決定とその理由を記録します。

---

## ADR-001: Next.js 16 App Routerの採用

**日付**: 2026-01-04
**ステータス**: 採用
**決定者**: AI Agent (Issue #3)

### コンテキスト
パーソナルトレーニングジムのECサイトを構築するにあたり、フロントエンドフレームワークの選定が必要でした。

### 決定内容
Next.js 16.1.1をApp Router構成で採用する。

### 理由
1. **サーバーサイドレンダリング (SSR)**
   - SEO最適化が重要なECサイトに最適
   - 初回ページロードが高速

2. **App Router**
   - React Server Componentsによるパフォーマンス最適化
   - ファイルベースルーティングで開発効率が向上
   - レイアウト共有が容易

3. **ビルトイン機能**
   - 画像最適化 (next/image)
   - フォント最適化 (next/font)
   - API Routes (バックエンド機能)

4. **デプロイ**
   - Vercelへの簡単なデプロイ
   - エッジランタイム対応

### 代替案
- **Create React App**: SSRがない、保守モードに入っている
- **Remix**: 新しいが、Next.jsほどエコシステムが成熟していない
- **Vue/Nuxt**: チームのTypeScript/Reactスキルセットに合致

### 影響
- TypeScript strictモードを使用
- App Routerのベストプラクティスに従う
- Server ComponentsとClient Componentsを適切に使い分ける

---

## ADR-002: Tailwind CSS v4の採用

**日付**: 2026-01-04
**ステータス**: 採用
**決定者**: AI Agent (Issue #3)

### コンテキスト
レスポンシブデザインとスタイリングの効率的な実装が必要。

### 決定内容
Tailwind CSS 4.1を採用し、@tailwindcss/postcssプラグインを使用する。

### 理由
1. **ユーティリティファースト**
   - 高速な開発速度
   - コンポーネント間でのスタイル再利用が容易

2. **レスポンシブデザイン**
   - モバイルファーストのブレークポイント
   - PC/タブレット/スマホ対応が容易

3. **パフォーマンス**
   - 本番ビルドで未使用CSSを自動削除
   - 小さいバンドルサイズ

4. **開発体験**
   - IntelliSense対応
   - カスタマイズが容易

### v4の選定理由
- Next.js 16との互換性
- @tailwindcss/postcssによるモダンなアーキテクチャ
- パフォーマンス改善

### 影響
- PostCSS設定が必要（postcss.config.cjs）
- globals.cssで@tailwindディレクティブを使用
- カスタムテーマはtailwind.config.cjsで管理

---

## ADR-003: TypeScript Strict Modeの採用

**日付**: 2026-01-04
**ステータス**: 採用
**決定者**: AI Agent (Issue #3)

### コンテキスト
型安全性とコード品質の確保が必要。

### 決定内容
TypeScript 5.8をstrictモードで使用する。

### 理由
1. **型安全性**
   - ランタイムエラーを事前に検出
   - リファクタリングが安全

2. **開発体験**
   - IntelliSenseによる自動補完
   - ドキュメントとしての役割

3. **保守性**
   - コードの意図が明確
   - チーム開発で品質を維持

### Strictモードの利点
- `null`/`undefined`チェックの強制
- 暗黙的な`any`の禁止
- より厳密な関数型チェック

### 影響
- すべての新規コードは型定義が必須
- 既存のJavaScriptライブラリには型定義が必要
- 開発初期は学習コストがある

---

## ADR-004: Miyabiフレームワークとの統合方針

**日付**: 2026-01-04
**ステータス**: 採用
**決定者**: AI Agent (Issue #3)

### コンテキスト
MiyabiフレームワークはAIエージェントによる自律開発を提供するが、Next.jsアプリケーションとどう統合するか。

### 決定内容
Miyabiフレームワークは開発ワークフロー層として、Next.jsアプリケーションとは分離して運用する。

### 理由
1. **関心の分離**
   - Miyabi: Issue管理、PR作成、CI/CD自動化
   - Next.js: アプリケーションロジック

2. **柔軟性**
   - Miyabiを削除してもアプリケーションは動作
   - 将来的に他のワークフローツールに移行可能

3. **保守性**
   - 各層の責務が明確
   - デバッグが容易

### 統合ポイント
- `.github/workflows/`: GitHub Actionsワークフロー
- `src/`: Miyabiフレームワークのコード（必要に応じて）
- `app/`: Next.jsアプリケーション

### 影響
- package.jsonに両方の依存関係が共存
- npm scriptsを使い分け（`npm run dev` vs `npm run miyabi`）

---

## ADR-005: PostgreSQLの採用（予定）

**日付**: 2026-01-04
**ステータス**: 提案中
**決定者**: 未定

### コンテキスト
ECサイトのデータベースとして、商品、注文、ユーザー情報を保存する必要がある。

### 決定内容（提案）
PostgreSQLをメインデータベースとして使用する。

### 理由
1. **リレーショナルデータ**
   - 商品、注文、ユーザーの関係性を適切に管理
   - トランザクション処理が必要

2. **スケーラビリティ**
   - 大量のデータに対応
   - インデックス最適化が可能

3. **エコシステム**
   - ORMサポート（Prisma、Drizzle）
   - クラウドプロバイダーのマネージドサービス

### 代替案
- **MySQL**: PostgreSQLと同等だが、JSON型のサポートが弱い
- **MongoDB**: NoSQLだが、ECサイトのトランザクション処理には不向き
- **Supabase**: PostgreSQL + BaaS、認証機能も提供

### 次のステップ
Issue #4でスキーマ設計を実施

---

## ADR-006: Stripeの採用（予定）

**日付**: 2026-01-04
**ステータス**: 提案中
**決定者**: 未定

### コンテキスト
クレジットカード決済機能が必要。

### 決定内容（提案）
Stripeを決済プラットフォームとして使用する。

### 理由
1. **セキュリティ**
   - PCI DSS準拠
   - カード情報を自社で保持しない

2. **機能**
   - サブスクリプション対応
   - 多様な決済手段

3. **開発体験**
   - Next.js用のSDKあり
   - 豊富なドキュメント

### 代替案
- **PayPal**: 認知度は高いが、開発体験はStripeに劣る
- **Square**: 主に店舗向け

### 次のステップ
Issue #6でStripe統合を実施

---

## ADR-007: NextAuth.jsの採用（予定）

**日付**: 2026-01-04
**ステータス**: 提案中
**決定者**: 未定

### コンテキスト
ユーザー認証・認可機能が必要。

### 決定内容（提案）
NextAuth.js v5を認証ライブラリとして使用する。

### 理由
1. **Next.js統合**
   - Next.js App Router対応
   - Server ComponentsとClient Componentsで使用可能

2. **機能**
   - Email/Password認証
   - OAuth対応（Google、Facebookなど）
   - セッション管理

3. **セキュリティ**
   - CSRF保護
   - JWT/データベースセッション

### 代替案
- **Clerk**: 高機能だが有料プランが必要
- **Supabase Auth**: Supabase使用時は選択肢
- **自作**: セキュリティリスクが高い

### 次のステップ
Issue #5で認証機能を実施

---

## 決定の更新プロセス

1. 新しい決定が必要になったら、このファイルに新しいADRを追加
2. 既存の決定を変更する場合は、新しいADRを追加し、古いADRのステータスを「非推奨」に変更
3. すべてのADRには日付と決定者を記録
4. 重要な決定はチームレビューを経る

---

**最終更新**: 2026-01-04
